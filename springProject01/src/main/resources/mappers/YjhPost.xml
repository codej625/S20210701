<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="PostDao">

	<!-- total -->
	<select id="total" parameterType="Post" resultType="int">
		select count(*) from post
		<where>
			<if test='bt_num!=0'> bt_num = #{bt_num} </if>
			<if test='bc_num!=0'> and bc_num = #{bc_num} </if>
		</where>
	</select>

	<!-- postList -->
	<select id="postList" parameterType="Post" resultType="Post">
		select * from
			(select rownum rn, a.* from
				(select * from post
					<where>
						<if test='bt_num!=0'> bt_num = #{bt_num} </if>
						<if test='bc_num!=0'> and bc_num = #{bc_num} </if>
					</where>
				order by bt_num,bc_num,p_num desc) a
			)
		where rn between #{start} and #{end}
	</select>
	
	<select id="registerMember" parameterType="Post" resultType="Post">
		select  *
		from    member
		where   m_id = #{m_id}
	</select>
	
<!-- postinsert -->
	<insert id="postInsert" parameterType="Post">
		insert into post
				(bt_num,bc_num,p_num,p_title,p_img,m_id,p_intro,p_info,p_gname,p_capa,p_cost,p_loc,p_metstart,p_metend,p_starttime,p_endtime,p_cstatus)
		values (#{bt_num},#{bc_num},(select max(p_num)+1 
									 from post 
									 where bt_num= #{bt_num} and bc_num = #{bc_num}),
				#{p_title},#{p_img},#{m_id},#{p_intro},#{p_info},#{p_gname},#{p_capa},#{p_cost},#{p_loc},#{p_metstart},#{p_metend},
				#{p_starttime},#{p_endtime},#{p_cstatus})
	</insert>
	
<!-- postListdetail -->
	<select id="postListDetail" parameterType="Post" resultType="Post">
		select  p.* , m.m_name, m.m_tel
		from    post p, member m
		where   p.bt_num =  #{bt_num}
		and     p.bc_num =#{bc_num}
		and     p.p_num =  #{p_num}
		and     p.m_id = m.m_id
		
	</select>
	
<!-- postListUpdate -->
	<update id="postListUpdate" parameterType="Post">
		update  post
		set 	p_title = #{p_title}, p_intro = #{p_intro}, p_info = #{p_intro}, p_gname = #{p_gname},
				p_capa = #{p_capa}, p_cost = #{p_cost}, p_loc = #{p_loc}, p_starttime = #{p_starttime},
				p_endtime = #{p_endtime}, p_cstatus = #{p_cstatus} 
		where 	bt_num = #{bt_num} and bc_num = #{bc_num} and p_num = #{p_num}
	</update>
	
<!-- postDelete -->
	<delete id="postDelete" parameterType="Post">
		delete from post where bt_num = #{bt_num} and bc_num = #{bc_num} and p_num = #{p_num}
	</delete>

</mapper>