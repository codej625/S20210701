<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="PostDao">

<!-- 	total -->
	<select id="total" parameterType="Post" resultType="int">
		select count(*) from post 
		<where>
		<if test='bt_num!=0'> bt_num = #{bt_num} </if>
		<if test='bc_num!=0'> and bc_num = #{bc_num} </if>
		</where>
	</select>
	
<!-- 	postList -->
	<select id="postList" parameterType="Post" resultType="Post">
		select * from 
			(select rownum rn, a.* from 
				(select * from post 
					<where>
					<if test='bt_num!=0'> bt_num = #{bt_num} </if>
					<if test='bc_num!=0'> and bc_num = #{bc_num} </if>
					</where>
				order by bt_num,bc_num,p_num) a
			)
		where rn between #{start} and #{end}
	</select>
	
	<insert id="postInsert" parameterType="Post">
		insert into post (bt_num,bc_num,p_num,p_title,p_intro,p_info,p_gname,p_capa,p_cost,p_loc,p_starttime,p_endtime,p_cstatus)
					values (#{bt_num},#{bc_num},(select max(p_num)+1 from post where bt_num= #{bt_num} and bc_num = #{bc_num}),
							#{p_title},#{p_intro},#{p_info},#{p_gname},#{p_capa},#{p_cost},#{p_loc},
							#{p_starttime},#{p_endtime},#{p_cstatus})
	</insert>


</mapper>